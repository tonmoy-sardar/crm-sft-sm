import { Component } from '@angular/core';
import { NgxPermissionsService } from 'ngx-permissions';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.scss']
})
export class AppComponent {
  title = 'npm';
  constructor(private permissionsService: NgxPermissionsService) {

    localStorage.setItem('loggedinToken', "ea8f78485a55e81812602984f8724b1bf7267eb0581b1047764ab6c95ed8124e")
    //localStorage.setItem('loggedinToken', '9ad1b28a64c6c928a335d72350806bb9ca3419defab99216d3628e3d4c8ce657')
    localStorage.setItem('isLoggedin', '1');
    localStorage.setItem('currentModuleId', '6')
    localStorage.setItem('userid', '2506');
    localStorage.setItem('switchUser', '');
    localStorage.setItem('name', 'Tonmoy Sardar');
    localStorage.setItem('module_access', '[{"id":6067,"user_type_details":{"id":3,"name":"Module User"},"module":{"id":10,"cm_name":"ATTENDANCE & HRMS","cm_url":"hrms","cm_icon":"https://shyamsteel.tech:8002/media/core/TCoreModule/Images/images.png"},"role":{"id":154,"cr_name":"HR Employees","cr_parent_id":147},"object_details":[{"id":62,"name":"Team Attendance","parent":0,"permission":3,"child_details":[]},{"id":91,"name":"My Attendance","parent":0,"permission":3,"child_details":[]}]},{"id":6068,"user_type_details":{"id":3,"name":"Module User"},"module":{"id":11,"cm_name":"E-Ticket","cm_url":"eticket","cm_icon":"https://shyamsteel.tech:8002/media/core/TCoreModule/Images/93819.png"},"role":{"id":163,"cr_name":"E-Ticket Admin","cr_parent_id":0},"object_details":[{"id":86,"name":"Deparment Reporting Head List","parent":0,"permission":3,"child_details":[]},{"id":87,"name":"All Open Tickets","parent":0,"permission":3,"child_details":[]},{"id":88,"name":"All Closed Tickets","parent":0,"permission":3,"child_details":[]},{"id":89,"name":"All Re-Open Tickets","parent":0,"permission":3,"child_details":[]},{"id":90,"name":"Employee Ticket Records","parent":0,"permission":3,"child_details":[]}]},{"id":6069,"user_type_details":{"id":3,"name":"Module User"},"module":{"id":1,"cm_name":"PMS","cm_url":"pms","cm_icon":"https://shyamsteel.tech:8002/media/core/TCoreModule/Images/1.png"},"role":{"id":152,"cr_name":"PMS Admin","cr_parent_id":0},"object_details":[{"id":8,"name":"Attendance","parent":0,"permission":3,"child_details":[{"id":28,"cot_name":"Attendance Report","description":"Attendance Report","cot_is_deleted":false,"cot_parent_id":8,"parent_permission":0,"permission":3,"child_details":[]},{"id":29,"cot_name":"Attendance Approval","description":"Attendance Approval","cot_is_deleted":false,"cot_parent_id":8,"parent_permission":0,"permission":3,"child_details":[]},{"id":30,"cot_name":"Advance Leave","description":"Advance Leave","cot_is_deleted":false,"cot_parent_id":8,"parent_permission":0,"permission":3,"child_details":[]}]},{"id":9,"name":"Manpower","parent":0,"permission":3,"child_details":[{"id":34,"cot_name":"Manpower List","description":"Manpower List","cot_is_deleted":false,"cot_parent_id":9,"parent_permission":0,"permission":3,"child_details":[]}]},{"id":11,"name":"Project","parent":0,"permission":3,"child_details":[{"id":35,"cot_name":"Project List","description":"Project List","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":36,"cot_name":"Pre-Execution","description":"Pre-Execution","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":37,"cot_name":"Execution","description":"Execution","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":38,"cot_name":"Post-Execution","description":"Post-Execution","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":39,"cot_name":"Purchases","description":"Purchases","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":40,"cot_name":"Stock","description":"Stock","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":41,"cot_name":"Active Projects","description":"Active Projects","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":42,"cot_name":"Approvals","description":"Approvals","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":43,"cot_name":"Closed Projects","description":"Closed Projects","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":44,"cot_name":"New Requisition","description":"New Requisition","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":45,"cot_name":"Planning and Reports","description":"Planning and Reports","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":46,"cot_name":"Stock Report","description":"Stock Report","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":47,"cot_name":"Stock Issue","description":"Stock Issue","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":49,"cot_name":"Project Plans","description":"Project Plans","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":50,"cot_name":"Progress Reports","description":"Progress Reports","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":51,"cot_name":"Add Daily Data","description":"Add Daily Data","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":55,"cot_name":"Requisition List","description":"Requisition List","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":57,"cot_name":"Requisition","description":"Requisition","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":59,"cot_name":"Comparative Statement","description":"comparative statement","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":3,"child_details":[]},{"id":80,"cot_name":"Tender Survey Data Verification","description":"Tender Survey Data Verification","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":0,"child_details":[]},{"id":81,"cot_name":"Pre-execution Data Verification","description":"Pre-execution Data Verification","cot_is_deleted":false,"cot_parent_id":11,"parent_permission":0,"permission":0,"child_details":[]}]},{"id":12,"name":"Tender","parent":0,"permission":3,"child_details":[{"id":52,"cot_name":"Tender List","description":"Tender List","cot_is_deleted":false,"cot_parent_id":12,"parent_permission":0,"permission":3,"child_details":[]},{"id":53,"cot_name":"Add New Tender","description":"Add New Tender","cot_is_deleted":false,"cot_parent_id":12,"parent_permission":0,"permission":3,"child_details":[]},{"id":54,"cot_name":"Archived Tenders","description":"Archived Tenders","cot_is_deleted":false,"cot_parent_id":12,"parent_permission":0,"permission":3,"child_details":[]},{"id":56,"cot_name":"Survey","description":"Survey","cot_is_deleted":false,"cot_parent_id":12,"parent_permission":0,"permission":3,"child_details":[]}]},{"id":13,"name":"Machinery","parent":0,"permission":3,"child_details":[{"id":31,"cot_name":"Add Machinery","description":"Add Machinery","cot_is_deleted":false,"cot_parent_id":13,"parent_permission":0,"permission":3,"child_details":[]},{"id":32,"cot_name":"Machinery List","description":"Machinery List","cot_is_deleted":false,"cot_parent_id":13,"parent_permission":0,"permission":3,"child_details":[]},{"id":33,"cot_name":"Machinery Report","description":"Machinery Report","cot_is_deleted":false,"cot_parent_id":13,"parent_permission":0,"permission":3,"child_details":[]}]},{"id":14,"name":"Project Site","parent":0,"permission":3,"child_details":[]},{"id":16,"name":"Machinery Type","parent":0,"permission":3,"child_details":[]},{"id":17,"name":"Material","parent":0,"permission":3,"child_details":[]},{"id":18,"name":"Vendor","parent":0,"permission":3,"child_details":[]},{"id":19,"name":"Contractor","parent":0,"permission":3,"child_details":[]},{"id":20,"name":"Operator","parent":0,"permission":3,"child_details":[]},{"id":21,"name":"Crusher","parent":0,"permission":3,"child_details":[]},{"id":22,"name":"Partners","parent":0,"permission":3,"child_details":[]},{"id":23,"name":"Requisition Type","parent":0,"permission":3,"child_details":[]},{"id":24,"name":"Payment Terms","parent":0,"permission":3,"child_details":[]},{"id":25,"name":"Activities","parent":0,"permission":3,"child_details":[]},{"id":26,"name":"Transport Cost","parent":0,"permission":3,"child_details":[]},{"id":27,"name":"Stock Issue Mode","parent":0,"permission":3,"child_details":[]},{"id":15,"name":"Machinery Working Category","parent":0,"permission":3,"child_details":[]}]},{"id":6070,"user_type_details":{"id":3,"name":"Module User"},"module":{"id":2,"cm_name":"VMS","cm_url":"vms","cm_icon":"https://shyamsteel.tech:8002/media/core/TCoreModule/Images/2.png"},"role":{"id":145,"cr_name":"VMS Admin","cr_parent_id":0},"object_details":[{"id":63,"name":"Visitor Entry","parent":0,"permission":3,"child_details":[]},{"id":64,"name":"Available Cards","parent":0,"permission":3,"child_details":[]},{"id":65,"name":"Visitor History","parent":0,"permission":3,"child_details":[]},{"id":66,"name":"Visitor List","parent":0,"permission":3,"child_details":[]},{"id":77,"name":"VMS Settings","parent":0,"permission":3,"child_details":[{"id":78,"cot_name":"Floors","description":"Floors","cot_is_deleted":false,"cot_parent_id":77,"parent_permission":0,"permission":3,"child_details":[]},{"id":79,"cot_name":"Cards","description":"Cards","cot_is_deleted":false,"cot_parent_id":77,"parent_permission":0,"permission":3,"child_details":[]}]}]},{"id":6071,"user_type_details":{"id":3,"name":"Module User"},"module":{"id":6,"cm_name":"E-Task","cm_url":"etask","cm_icon":"https://shyamsteel.tech:8002/media/core/TCoreModule/Images/e_task.png"},"role":{"id":146,"cr_name":"E-Task Admin","cr_parent_id":0},"object_details":[{"id":67,"name":"My Tasks","parent":0,"permission":3,"child_details":[]},{"id":68,"name":"Follow Up","parent":0,"permission":3,"child_details":[]}]}]');


    localStorage.setItem('switchUser', '');
    var index = JSON.parse(localStorage.getItem('module_access')).findIndex(k => k.module['id'] == localStorage.getItem('currentModuleId'))

    localStorage.setItem('current_module_access', JSON.stringify(JSON.parse(localStorage.getItem('module_access'))[index]));
  }

  ngOnInit(): void {
    this.loadPermission();
  }

  loadPermission() {

    //console.log(localStorage.getItem('module_access'));
    this.permissionsService.flushPermissions();
    const perm = ['dsd']
    perm.push(localStorage.getItem('userRole'))
    this.permissionsService.addPermission(perm)
    this.permissionsService.loadPermissions(perm, (permissionName, permissionStore) => {
      return !!permissionStore[permissionName];
    })
  }
}